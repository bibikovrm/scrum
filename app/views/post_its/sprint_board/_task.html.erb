<%- task_id = "task_#{task.id}" -%>
<table id="<%= task_id %>" class="<%= task.post_it_css_class(:rotate => true, :scale => true, :draggable => true) %>">
  <tr>
    <td class="content" colspan="3">
      <%= link_to_issue(task, :tracker => false, :truncate => 100) %>
      <div class="doers-reviewers-post-its-container">
        <%- task.doers.each do |doer| -%>
          <div class="<%= Issue.doer_post_it_css_class %>">
            <%= link_to_user(doer) %>
          </div>
        <%- end -%>
        <%- task.reviewers.each do |reviewer| -%>
          <div class="<%= Issue.reviewer_post_it_css_class %>">
            <%= link_to_user(reviewer) %>
          </div>
        <%- end -%>
      </div>
    </td>
  </tr>
  <tr>
    <td class="estimation">
      <%= render_hours(task.estimated_hours, :title => l(:field_estimated_hours)) %>
    </td>
    <td class="spent">
      <%= render_hours(task.spent_hours, :title => l(:label_spent_time), :ignore_zero => true) %>
    </td>
    <td class="pending">
      <%- if task.has_pending_effort? -%>
        <%= render :partial => "common/scrum_pending_effort",
                   :locals => {:project => project, :task => task} %>
        <span title="<%= Issue.label_pending_effort %>">h</span>
      <%- end -%>
    </td>
  </tr>
</table>

<%- context_menu_id = "task_#{task.id}_context_menu"
    context_menu_assigned_to_id = "task_#{task.id}_context_menu_assigned_to"
    members = task.project.members.collect{|member| [member.user.name, member.user.id]}
    members_options = options_for_select(members, task.assigned_to.nil? ? nil : task.assigned_to.id)
    members_select = select_tag context_menu_assigned_to_id, members_options, :include_blank => true
    members_select["\n"] = "" -%>
<div id="<%= context_menu_id %>" class="scrum-custom-menu">
  <label><%= l(:field_assigned_to) %>:</label>
  <%= members_select %>
</div>

<%= render :partial => "post_its/sprint_board/task",
           :formats => [:js],
           :locals => {:project => project,
                       :user_story_status_id => user_story_status_id,
                       :other_user_story_status_ids => other_user_story_status_ids,
                       :task_id => task_id,
                       :task => task,
                       :context_menu_id => context_menu_id,
                       :context_menu_assigned_to_id => context_menu_assigned_to_id,
                       :container_task_id => task_id} %>
