<%= javascript_tag do %>
  var effort_by_activity_data = [
    <%- effort_by_activity.each do |activity| -%>
      {
        key: "<%= activity[:activity].name %>",
        y: <%= activity[:total] %>
      },
    <%- end -%>
  ];
  nv.addGraph(function() {
    var width = <%= chart_options[:width] %>, height = <%= chart_options[:height] %>;
    var chart = nv.models.pieChart()
      .x(function(d) { return d.key })
      .y(function(d) { return d.y })
      .showLabels(true)
      .labelType("percent")
      .color(d3.scale.category10().range())
      .width(width)
      .height(height);
    d3.select("#stats_effort_by_activity")
      .datum(effort_by_activity_data)
      .transition().duration(1200)
      .attr('width', width)
      .attr('height', height)
      .call(chart);
    chart.dispatch.on('stateChange', function(e) { nv.log('New State:', JSON.stringify(e)); });
    return chart;
  });
<% end %>